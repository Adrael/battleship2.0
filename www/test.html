<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test</title>
    <script src="https://cdn.socket.io/socket.io-1.4.8.js"></script>
    <style>

        h1 {
            font-size: 15px;
        }

        #messages {
            width: 100%;
        }

        #messages > div {
            border-bottom: 1px solid #BBB;
            font-size: 10px;
            color: black;
        }

        #messages > div.new_player {
            font-weight: bold;
            color: cadetblue;
        }
        #messages > div.success {
            color: darkgreen;
        }
        #messages > div.failure {
            color: darkred;
        }

        textarea {
            width: 100%;
            font-size: 12px;
            font-family: "Droid Sans Mono";
        }

    </style>
</head>
<body>
<h1>toto</h1>
<div id="messages"></div>
<div id="actions"></div>
<script>

    var socket = io('http://localhost:9001');
    socket.on('nickname', function (nickname) {
        socket.nickname = nickname;
        document.querySelector('h1').textContent = nickname;
        window.setTimeout(function () {
            console.log(nickname);
            socket.emit('list games');
        }, Math.random() * 3000);
    });

    socket.on('list games', function (lists) {
        if (lists.length === 0) {
            var game = {
                name: 'toto',
                maxPlayers: 4
            };
            socket.emit('create game', game);
        } else {
            socket.emit('join game', {gameId: lists[0].id});
        }
    });

    socket.on('game created', function (game) {
        console.log(game);
        var message = document.createElement('div');
        message.textContent = 'I created the game';
        message.classList.add('creator');
        document.getElementById('messages').appendChild(message);
    });

    socket.on('new player', function (player) {
        var message = document.createElement('div');
        message.textContent = player.nickname + ' has join the game';
        message.classList.add('new_player');
        document.getElementById('messages').appendChild(message);
    });

    socket.on('game start', function () {
        var message = document.createElement('div');
        message.textContent = 'The game will start soon';
        document.getElementById('messages').appendChild(message);

        var button = document.createElement('button');
        button.textContent = 'ready';
        document.getElementById('actions').innerHTML = '';
        document.getElementById('actions').appendChild(button);

        var ready = false;
        button.addEventListener('click', function () {
            ready = !ready;
            socket.emit('ready', ready);
        });
    });

    socket.on('player ready', function (data) {
        var message = document.createElement('div');
        if (data.isReady) {
            message.textContent = 'player ' + data.nickname + ' is ready!';
            message.classList.add('success');
        } else {
            message.textContent = 'player ' + data.nickname + ' is not ready.';
            message.classList.add('failure');
        }
        document.getElementById('messages').appendChild(message);
    });

    socket.on('set ships', function (ships) {
        var message = document.createElement('div');
        message.textContent = 'Place your ships!';
        document.getElementById('messages').appendChild(message);

        var text = document.createElement('textarea');
        text.textContent = "[{\n" +
            "  \"x\": 0,\n" +
            "  \"y\": 0,\n" +
            "  \"width\": 1,\n" +
            "  \"height\": 5,\n" +
            "  \"type\":\"destroyer\"\n" +
            "}]";
        var button = document.createElement('button');
        button.textContent = 'send';
        document.getElementById('actions').innerHTML = '';
        document.getElementById('actions').appendChild(text);
        document.getElementById('actions').appendChild(button);

        button.addEventListener('click', function () {
            try {
                var json = JSON.parse(text.value);
                socket.emit('place ships', json);
            } catch (e) {
                console.log(e);
            }
        });
        console.log(ships);
    });

    socket.on('ship placed', function (result) {
        var message = document.createElement('div');
        if (result.error) {
            message.textContent = result.error;
            message.classList.add('failure');
        } else {
            message.textContent = 'Ships placed!';
            message.classList.add('success');
        }
        document.getElementById('messages').appendChild(message);
    });

</script>
</body>
</html>
